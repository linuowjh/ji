# 云念小程序开发指南

## 📱 在微信开发者工具中打开

### 前置条件

1. **安装微信开发者工具**
   - 下载地址：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
   - 选择对应操作系统的稳定版本

2. **注册微信小程序账号**（可选，开发阶段可使用测试号）
   - 访问：https://mp.weixin.qq.com/
   - 注册小程序账号并获取AppID

### 打开步骤

#### 方法一：直接导入项目

1. 打开微信开发者工具
2. 点击"+"或"导入项目"
3. 选择项目目录：`/path/to/yun-nian-memorial/miniprogram`
4. 填写项目信息：
   - **项目名称**：云念小程序
   - **目录**：选择miniprogram文件夹
   - **AppID**：
     - 如果有正式AppID，填写你的AppID
     - 如果没有，选择"测试号"或使用"touristappid"
   - **开发模式**：小程序
5. 点击"导入"

#### 方法二：使用命令行工具

```bash
# 安装微信开发者工具命令行
# macOS
/Applications/wechatwebdevtools.app/Contents/MacOS/cli

# 打开项目
cli open --project /path/to/yun-nian-memorial/miniprogram
```

### 当前项目状态

✅ **已完成的配置**：
- `project.config.json` - 项目配置文件
- `app.json` - 小程序全局配置
- `app.js` - 小程序入口文件
- `app.wxss` - 全局样式
- `sitemap.json` - 搜索配置

✅ **已实现的页面**：
- 首页 (`pages/index/`)
- 纪念馆列表 (`pages/memorial/list/`)
- 纪念馆详情 (`pages/memorial/detail/`)
- 创建纪念馆 (`pages/memorial/create/`)
- 祭扫页面 (`pages/memorial/worship/`)
- 家族列表 (`pages/family/list/`)
- 家族详情 (`pages/family/detail/`)
- 个人中心 (`pages/profile/`)

✅ **已实现的组件**：
- 媒体上传器 (`components/media-uploader/`)
- 祈福墙 (`components/prayer-wall/`)
- 时间胶囊 (`components/time-capsule/`)
- 祭扫面板 (`components/worship-panel/`)

⚠️ **需要补充的内容**：

1. **TabBar图标**（必需）
   - 位置：`miniprogram/images/`
   - 需要8个图标文件（详见 `images/.gitkeep`）
   - 规格：81px * 81px，PNG格式

2. **后端API配置**
   - 修改 `utils/api.js` 中的 `BASE_URL`
   - 配置为你的后端服务地址

3. **AppID配置**（生产环境）
   - 修改 `project.config.json` 中的 `appid`
   - 替换为你的正式小程序AppID

## 🔧 开发配置

### 1. 配置后端API地址

编辑 `miniprogram/utils/api.js`：

```javascript
// 开发环境
const BASE_URL = 'http://localhost:8080/api/v1'

// 生产环境
// const BASE_URL = 'https://your-domain.com/api/v1'
```

### 2. 配置AppID

编辑 `miniprogram/project.config.json`：

```json
{
  "appid": "your-real-appid",  // 替换为你的AppID
  "projectname": "yunnian-miniprogram"
}
```

### 3. 配置服务器域名（生产环境）

在微信公众平台配置合法域名：
1. 登录 https://mp.weixin.qq.com/
2. 进入"开发" -> "开发管理" -> "开发设置"
3. 配置"服务器域名"：
   - request合法域名：`https://your-domain.com`
   - uploadFile合法域名：`https://your-domain.com`
   - downloadFile合法域名：`https://your-domain.com`

## 🚀 开始开发

### 1. 启动后端服务

```bash
# 在项目根目录
go run cmd/server/main.go
```

### 2. 在开发者工具中预览

1. 打开微信开发者工具
2. 导入miniprogram项目
3. 点击"编译"按钮
4. 在模拟器中查看效果

### 3. 真机调试

1. 点击工具栏的"预览"按钮
2. 使用微信扫描二维码
3. 在手机上查看实际效果

## 📝 开发注意事项

### 1. 本地开发设置

在开发者工具中：
- 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
- 这样可以在开发阶段使用localhost

### 2. 网络请求

所有API请求都通过 `utils/api.js` 统一管理：

```javascript
import { request } from '../../utils/api'

// GET请求
request('/memorials', 'GET')
  .then(res => console.log(res))

// POST请求
request('/memorials', 'POST', { name: '纪念馆名称' })
  .then(res => console.log(res))
```

### 3. 用户登录

小程序使用微信登录：

```javascript
// 在app.js中已实现
wx.login({
  success: res => {
    // 发送code到后端
    request('/auth/login', 'POST', { code: res.code })
  }
})
```

### 4. 媒体上传

使用封装好的上传组件：

```javascript
// 在页面中使用
<media-uploader 
  bind:upload="onMediaUpload"
  max-count="9"
  media-type="image"
/>
```

## 🐛 常见问题

### 1. 无法打开项目

**问题**：提示"不是有效的小程序项目"

**解决**：
- 确认选择的是 `miniprogram` 文件夹
- 检查 `project.config.json` 是否存在
- 检查 `app.json` 是否存在

### 2. TabBar不显示

**问题**：底部导航栏不显示或显示异常

**解决**：
- 检查 `images` 目录是否存在
- 确认所有图标文件都已放置
- 图标规格必须是 81px * 81px

### 3. 网络请求失败

**问题**：API请求返回错误

**解决**：
- 检查后端服务是否启动
- 确认 `utils/api.js` 中的 `BASE_URL` 配置正确
- 开发阶段勾选"不校验合法域名"

### 4. 页面空白

**问题**：打开页面后显示空白

**解决**：
- 打开调试器查看Console错误
- 检查页面的 `.js`、`.wxml`、`.wxss` 文件是否完整
- 确认 `app.json` 中的页面路径配置正确

## 📚 相关文档

- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信开发者工具文档](https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html)
- [小程序API文档](https://developers.weixin.qq.com/miniprogram/dev/api/)

## 🎯 下一步

1. **补充TabBar图标**
   - 设计或下载8个图标文件
   - 放置到 `images` 目录

2. **配置后端地址**
   - 修改 `utils/api.js`
   - 启动后端服务

3. **开始开发**
   - 在开发者工具中打开项目
   - 开始编码和调试

4. **测试功能**
   - 测试各个页面
   - 测试API交互
   - 真机调试

## ✅ 快速检查清单

在开发者工具中打开前，确认：

- [ ] 已安装微信开发者工具
- [ ] `miniprogram` 目录存在
- [ ] `project.config.json` 存在
- [ ] `app.json` 存在
- [ ] `app.js` 存在
- [ ] 后端服务已启动（可选）
- [ ] TabBar图标已准备（可选，不影响打开）

**即使缺少图标，项目也可以在开发者工具中打开和运行！** 只是TabBar会显示占位符。
